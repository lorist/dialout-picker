import{a as T}from"./index-CPUxJOtF.js";const v="./data/dial_targets.csv",x=[{label:"Boardroom (SIP)",destination:"sip:ep3@anzsec.pextest.com",protocol:"auto",role:"GUEST"},{label:"Security desk (SIP)",destination:"sip:security@company.com",protocol:"auto",role:"GUEST"},{label:"Legacy codec",destination:"h323:10.0.0.50",protocol:"auto",role:"GUEST"},{label:"Recorder",destination:"rtmp://recorder.example.com/live/room1",protocol:"auto",role:"GUEST"}];function B(n){return n.replace(/^\uFEFF/,"")}function I(n){const o=(n||"").trim().toLowerCase();return/^[a-z][a-z0-9+.-]*:/.test(o)}function S(n){const o=(n||"").trim().toLowerCase();return!o||o==="auto"?"auto":o==="sip"||o==="h323"||o==="mssip"||o==="rtmp"?o:"auto"}function $(n){return(n||"").trim().toLowerCase()==="host"?"HOST":"GUEST"}function H(n){const o=[];let e=[],i="",d=!1;for(let l=0;l<n.length;l++){const a=n[l];if(d){a==='"'?n[l+1]==='"'?(i+='"',l++):d=!1:i+=a;continue}if(a==='"'){d=!0;continue}if(a===","){e.push(i),i="";continue}if(a===`
`){e.push(i),o.push(e),e=[],i="";continue}a!=="\r"&&(i+=a)}return(i.length||e.length)&&(e.push(i),o.push(e)),o}function P(n){const o=H(B(n)).filter(t=>t.some(p=>(p||"").trim()!==""));if(!o.length)return[];const e=o[0].map(t=>(t||"").trim().toLowerCase()),i=t=>e.indexOf(t),d=i("label"),l=i("destination"),a=i("protocol"),m=i("role"),f=(e.includes("label")||e.includes("destination")||e.includes("protocol")||e.includes("role")?o.slice(1):o).map(t=>t.map(p=>(p??"").trim())).map(t=>{const p=(d>=0?t[d]:t[0])||"",w=(l>=0?t[l]:t[1])||"",s=S(a>=0?t[a]:t[2]),r=$(m>=0?t[m]:t[3]);return{label:p,destination:w,protocol:s,role:r}}).filter(t=>t.label&&t.destination),h=new Set;return f.filter(t=>h.has(t.destination)?!1:(h.add(t.destination),!0))}async function A(){try{const n=await fetch(v,{cache:"no-store"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const o=await n.text(),e=P(o);if(!e.length)throw new Error("CSV parsed but no entries found");return e}catch(n){return console.warn(`dialout-picker widget: CSV load failed (${v}). Using fallback list.`,n),x}}function U(n,o){const e=(o||"").trim().toLowerCase();return e?`${n.label} ${n.destination}`.toLowerCase().includes(e):!0}function k(n){return`${n.label} — ${n.destination}`}(async()=>{const n=await T({parentPluginId:"dialout-picker"}),o=document.getElementById("q"),e=document.getElementById("target"),i=document.getElementById("joinAs"),d=document.getElementById("protocol"),l=document.getElementById("displayName"),a=document.getElementById("dialBtn"),m=document.getElementById("countHint"),u=document.getElementById("status"),c=[];if(o||c.push("#q"),e||c.push("#target"),i||c.push("#joinAs"),d||c.push("#protocol"),l||c.push("#displayName"),a||c.push("#dialBtn"),m||c.push("#countHint"),u||c.push("#status"),c.length){console.error("dialout-picker widget: missing elements:",c),u&&(u.textContent=`Widget UI error: missing ${c.join(", ")}`);return}a.disabled=!0,m.textContent="Loading targets…";const f=await A(),h=new Map(f.map(s=>[s.destination,s]));let t=[...f];function p(){const s=e.value;if(e.innerHTML="",t.forEach(r=>{const g=document.createElement("option");g.value=r.destination,g.textContent=k(r),e.appendChild(g)}),t.length===0){const r=document.createElement("option");r.value="",r.textContent="No matches",e.appendChild(r),e.value="",a.disabled=!0,m.textContent="0 matches";return}e.value=t.some(r=>r.destination===s)?s:t[0].destination,a.disabled=!1,m.textContent=`${t.length} match${t.length===1?"":"es"}`}function w(){const s=o.value;t=f.filter(r=>U(r,s)),p()}o.addEventListener("input",w),e.addEventListener("change",()=>{const s=h.get(e.value);s&&!(l.value||"").trim()&&(l.placeholder=s.label||"Defaults to the selected label")}),p(),a.addEventListener("click",async()=>{u.textContent="";const s=e.value,r=h.get(s);if(!s||!r){u.textContent="Please select a valid target.";return}const g=r.role||i.value||"GUEST",C=S(r.protocol||d.value||"auto"),L=I(s),E=(l.value||"").trim()||r.label||"Dial-out participant",b={destination:s,role:g,protocol:"auto",remote_display_name:E,text:E};!L&&C!=="auto"&&(b.protocol=C);try{a.disabled=!0,u.textContent=`Dialing ${E}…`,await n.conference.dialOut(b),u.textContent=`Dial started: ${E}`}catch(y){u.textContent=`Dial-out failed: ${(y==null?void 0:y.message)||y}`}finally{a.disabled=t.length===0}})})();
