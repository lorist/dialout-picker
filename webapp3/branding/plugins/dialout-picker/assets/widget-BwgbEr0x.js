import{a as T}from"./index-CPUxJOtF.js";const b="./data/dial_targets.csv",L=[{label:"Boardroom (SIP)",destination:"sip:ep3@anzsec.pextest.com",protocol:"auto",role:"GUEST"},{label:"Security desk (SIP)",destination:"sip:security@company.com",protocol:"auto",role:"GUEST"},{label:"Legacy codec",destination:"h323:10.0.0.50",protocol:"auto",role:"GUEST"},{label:"Recorder",destination:"rtmp://recorder.example.com/live/room1",protocol:"auto",role:"GUEST"}];function x(t){return t.replace(/^\uFEFF/,"")}function B(t){const n=(t||"").trim().toLowerCase();return/^[a-z][a-z0-9+.-]*:/.test(n)}function v(t){const n=(t||"").trim().toLowerCase();return!n||n==="auto"?"auto":n==="sip"||n==="h323"||n==="mssip"||n==="rtmp"?n:"auto"}function I(t){return(t||"").trim().toLowerCase()==="host"?"HOST":"GUEST"}function $(t){const n=[];let e=[],a="",d=!1;for(let l=0;l<t.length;l++){const s=t[l];if(d){s==='"'?t[l+1]==='"'?(a+='"',l++):d=!1:a+=s;continue}if(s==='"'){d=!0;continue}if(s===","){e.push(a),a="";continue}if(s===`
`){e.push(a),n.push(e),e=[],a="";continue}s!=="\r"&&(a+=s)}return(a.length||e.length)&&(e.push(a),n.push(e)),n}function H(t){const n=$(x(t)).filter(o=>o.some(u=>(u||"").trim()!==""));if(!n.length)return[];const e=n[0].map(o=>(o||"").trim().toLowerCase()),a=o=>e.indexOf(o),d=a("label"),l=a("destination"),s=a("protocol"),f=a("role"),w=(e.includes("label")||e.includes("destination")||e.includes("protocol")||e.includes("role")?n.slice(1):n).map(o=>o.map(u=>(u??"").trim())).map(o=>{const u=(d>=0?o[d]:o[0])||"",r=(l>=0?o[l]:o[1])||"",i=v(s>=0?o[s]:o[2]),m=I(f>=0?o[f]:o[3]);return{label:u,destination:r,protocol:i,role:m}}).filter(o=>o.label&&o.destination),c=new Set;return w.filter(o=>c.has(o.destination)?!1:(c.add(o.destination),!0))}async function P(){try{const t=await fetch(b,{cache:"no-store"});if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.text(),e=H(n);if(!e.length)throw new Error("CSV parsed but no entries found");return e}catch(t){return console.warn(`dialout-picker widget: CSV load failed (${b}). Using fallback list.`,t),L}}function A(t,n){const e=(n||"").trim().toLowerCase();return e?`${t.label} ${t.destination}`.toLowerCase().includes(e):!0}function G(t){return`${t.label} — ${t.destination}`}(async()=>{const t=await T({parentPluginId:"dialout-picker"}),n=document.getElementById("q"),e=document.getElementById("target"),a=document.getElementById("joinAs"),d=document.getElementById("protocol"),l=document.getElementById("displayName"),s=document.getElementById("dialBtn"),f=document.getElementById("countHint"),p=document.getElementById("status"),h=await P(),w=new Map(h.map(r=>[r.destination,r]));let c=[...h];function o(){const r=e.value;if(e.innerHTML="",c.forEach(i=>{const m=document.createElement("option");m.value=i.destination,m.textContent=G(i),e.appendChild(m)}),c.length===0){const i=document.createElement("option");i.value="",i.textContent="No matches",e.appendChild(i),e.value="",s.disabled=!0,f.textContent="0 matches";return}e.value=c.some(i=>i.destination===r)?r:c[0].destination,s.disabled=!1,f.textContent=`${c.length} match${c.length===1?"":"es"}`}function u(){const r=n.value;c=h.filter(i=>A(i,r)),o()}n.addEventListener("input",u),o(),s.addEventListener("click",async()=>{p.textContent="";const r=e.value,i=w.get(r);if(!r||!i){p.textContent="Please select a valid target.";return}const m=i.role||a.value||"GUEST",y=v(i.protocol||d.value||"auto"),S=B(r),g=(l.value||"").trim()||i.label||"Dial-out participant",C={destination:r,role:m,protocol:"auto",remote_display_name:g,text:g};!S&&y!=="auto"&&(C.protocol=y);try{s.disabled=!0,p.textContent=`Dialing ${g}…`,await t.conference.dialOut(C),p.textContent=`Dial started: ${g}`,s.disabled=!1}catch(E){s.disabled=!1,p.textContent=`Dial-out failed: ${(E==null?void 0:E.message)||E}`}})})();
