(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function s(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(i){if(i.ep)return;i.ep=!0;const l=s(i);fetch(i.href,l)}})();var _;(function(e){e[e.trace=10]="trace",e[e.debug=20]="debug",e[e.info=30]="info",e[e.warn=40]="warn",e[e.error=50]="error",e[e.fatal=60]="fatal",e[e.silent=9007199254740991]="silent"})(_||(_={}));function ae(){return Object.freeze({fatal:(e,a)=>console.error(a,e),error:(e,a)=>console.error(a,e),warn:(e,a)=>console.warn(a,e),info:(e,a)=>console.info(a,e),debug:(e,a)=>console.debug(a,e),trace(){},silent(){},redact(e){return e},addRedactPattern(){}})}let E=ae();const re={},G=e=>{const a=new Array;return{[Symbol.iterator]:()=>a[Symbol.iterator](),get size(){return a.length},add:s=>{e!==0&&(a.length<e?a.splice(e,0,s):(a.shift(),a.push(s)))},clear:()=>{a.length=0},entries:()=>a.entries()}},ne="Anonymous",ie="AnonymousSignal",oe=2;function C(e){return e.name||ne}function u(e={variant:"generic"}){const{allowEmittingWithoutObserver:a=!1,variant:s="generic",name:o=ie}=e??{},i=new Set,l=new WeakMap,c=new WeakSet;let b=!1,R=!1,p;switch(e==null?void 0:e.variant){case"batched":case"replay":{if(e.bufferSize!==void 0&&e.bufferSize<1)throw new Error("Batched/Replay Signal bufferSize must be greater than 0");if(e.bufferSize===1){const n={bufferSize:e.bufferSize,name:o,variant:s};switch(e.variant){case"batched":e.emitImmediatelyWhenFull&&E.warn(n,"Batched signal with buffer size of 1 is basically a Generic signal");break;case"replay":E.warn(n,"Replay signal with bufferSize of 1 is identical to Behavior signal");break}}p=G(e.bufferSize??oe);break}case"behavior":{p=G(1);break}}if((e==null?void 0:e.variant)==="batched"&&e.schedule===void 0)throw new Error("Batched signal requires a scheduler to be provided in the options");function P(n,d){try{const g=l.get(n);E.trace({signal:o,variant:s,subject:d,observer:n,context:g},`Emitting a subject to observer ${C(n)}`),n.call(g,d),c.has(n)&&h(n)}catch(g){throw E.error({signal:o,variant:s,error:g,observer:n,subject:d},`emit with error for observer ${C(n)}`),g instanceof RangeError?new RangeError(`RangeError: Possible recursive call when calling ${C(n)} for ${o}`):g}}const O=(n,d)=>{if(i.has(n)){const g=`Observer ${C(n)} has already been added!`;throw E.error({signal:o,variant:s,observer:n},g),new Error(`DuplicatedObserver: ${g}`)}switch(E.trace({signal:o,variant:s,observer:n},`Adding ${C(n)} to ${o}`),i.add(n),d!=null&&d.context&&l.set(n,d.context),s){case"replay":case"behavior":{for(const g of p??[])P(n,g);break}}if(d!=null&&d.signal){const g=()=>{var W;h(n),(W=d.signal)==null||W.removeEventListener("abort",g)};return d.signal.addEventListener("abort",g),g}return()=>h(n)},k=(n,d)=>{if(c.has(n)){const g=`${C(n)} has already been added once to ${o}!`;throw E.error({signal:o,variant:s,observer:n},g),new Error(`NoOnceAgain: ${g}`)}return c.add(n),O(n,d)},h=n=>{if(!i.delete(n))throw E.error({signal:o,variant:s,observer:n},`Unable to remove observer ${C(n)}`),new Error(`UnableToRemove: ${C(n)}`);c.delete(n),l.delete(n),E.trace({signal:o,variant:s,observer:n},`Removed ${C(n)} from ${o}`)},v=()=>i.size,I=()=>{if(!R||!p||p.size<1)return;const n=[];for(const d of p)d!==void 0&&n.push(d);p.clear();for(const d of i)P(d,n);b=!1,R=!1};function B(n){if(p)p.add(n);else if(!i.size&&!a){const{stack:d}=re.debug?new Error:{stack:void 0};E.warn({signal:o,variant:s,subject:n,stack:d},`Emitting ${o} without any observer! This may be a mistake.`)}switch(e.variant){case"batched":{e.emitImmediatelyWhenFull&&(p==null?void 0:p.size)===e.bufferSize?(R=!0,I()):!b&&(p==null?void 0:p.size)===1&&(b=!0,R=!0,e.schedule(I));break}default:{for(const d of i)P(d,n);break}}}return{name:o,get size(){return v()},add:O,addOnce:k,remove:h,emit:B}}var K;(function(e){e[e.trace=10]="trace",e[e.debug=20]="debug",e[e.info=30]="info",e[e.warn=40]="warn",e[e.error=50]="error",e[e.fatal=60]="fatal",e[e.silent=9007199254740991]="silent"})(K||(K={}));function se(){return Object.freeze({fatal:(e,a)=>console.error(a,e),error:(e,a)=>console.error(a,e),warn:(e,a)=>console.warn(a,e),info:(e,a)=>console.info(a,e),debug:(e,a)=>console.debug(a,e),trace(){},silent(){},redact(e){return e},addRedactPattern(){}})}let U=se();function ce(e){return typeof e=="string"&&e.length>0}function ue(e){return!!(e&&typeof e=="object"&&"chanId"in e&&"event"in e)}function le(e){return!!(e&&typeof e=="object"&&"chanId"in e&&"replyTo"in e)}const w=[];for(let e=0;e<256;++e)w.push((e+256).toString(16).slice(1));function de(e,a=0){return(w[e[a+0]]+w[e[a+1]]+w[e[a+2]]+w[e[a+3]]+"-"+w[e[a+4]]+w[e[a+5]]+"-"+w[e[a+6]]+w[e[a+7]]+"-"+w[e[a+8]]+w[e[a+9]]+"-"+w[e[a+10]]+w[e[a+11]]+w[e[a+12]]+w[e[a+13]]+w[e[a+14]]+w[e[a+15]]).toLowerCase()}let z;const pe=new Uint8Array(16);function fe(){if(!z){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");z=crypto.getRandomValues.bind(crypto)}return z(pe)}const ge=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Z={randomUUID:ge};function me(e,a,s){var i;if(Z.randomUUID&&!e)return Z.randomUUID();e=e||{};const o=e.random??((i=e.rng)==null?void 0:i.call(e))??fe();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,de(o)}function j(e){return`${e?`${e}-`:""}${me()}`}function Y(){const e=new Map,a=new Set;return window.onbeforeunload=()=>{for(const c of a)clearInterval(c);a.clear()},{add:(c,b)=>{if(e.has(c)){U.warn(`A popup with with ID:'${c}' has already been registered`);return}e.set(c,{popup:null,shouldOpen:b})},remove:c=>{e.delete(c)},open:(c,b,R)=>{var O,k,h;e.has(c)||e.set(c,{popup:null});const p=e.get(c);if(p!=null&&p.popup&&!p.popup.closed){U.warn(`Popup with ID:'${c}' is currently opened`);return}if((O=e.get(c))!=null&&O.shouldOpen&&!((h=(k=e.get(c))==null?void 0:k.shouldOpen)!=null&&h.call(k,R??{})))return;const P=window.open(...b);if(p&&(p.popup=P),P){const v=window.setInterval(()=>{if(P.closed){const I=e.get(c);I&&(I.popup=null),clearInterval(v),a.delete(v)}},500);a.add(v)}},get:c=>{var b;return(b=e.get(c))==null?void 0:b.popup}}}class L{constructor(a,s){this.target=a,this.chanId=s,this.pendingCalls=new Map,this.eventListeners=new Set,this.onMessage=o=>{if(o.data.chanId!==this.chanId)return;const i=o.data;if(U.debug({evt:o},`Message received for channel ${this.chanId}`),le(i)){const[l,c]=this.pendingCalls.get(i.replyTo)??[];if(!l){U.debug({evt:o},"Resolve fn doesnt exist");return}this.pendingCalls.delete(i.replyTo),l(i.payload)}if(ue(i))for(const l of this.eventListeners)l(i)},globalThis.addEventListener("message",this.onMessage)}addEventListener(a){this.eventListeners.add(a)}removeEventListener(a){this.eventListeners.delete(a)}emitEvent(a){this.target.postMessage({chanId:this.chanId,...a},"*")}callRPC(a,s,o){const i=j();return U.debug({payload:s,id:i},`'${a}' called for channel ${this.chanId}`),new Promise((l,c)=>{this.pendingCalls.set(i,[l,c]),this.target.postMessage({rpc:a,payload:s,id:i,chanId:this.chanId},"*",o)})}replyRPC(a){this.emitEvent(a)}sendEvent(a){this.emitEvent(a)}unregister(){globalThis.removeEventListener("message",this.onMessage)}get targetWindow(){return this.target}}var Q;(function(e){e.audio="audio",e.video="video",e.api="api"})(Q||(Q={}));var X;(function(e){e[e.Join=0]="Join",e[e.Leave=1]="Leave",e[e.Update=2]="Update"})(X||(X={}));const ee=e=>{const a=new Map,s=new Map,o=new Map,i=new Map,l=new Map,c=u({allowEmittingWithoutObserver:!0}),b=u({allowEmittingWithoutObserver:!0}),R=u({allowEmittingWithoutObserver:!0}),p=u({allowEmittingWithoutObserver:!0}),P=u({allowEmittingWithoutObserver:!0}),O=u({allowEmittingWithoutObserver:!0}),k=u({allowEmittingWithoutObserver:!0}),h=u({allowEmittingWithoutObserver:!0}),v=u({allowEmittingWithoutObserver:!0}),I=u({allowEmittingWithoutObserver:!0}),B=u({allowEmittingWithoutObserver:!0}),n=u({allowEmittingWithoutObserver:!0}),d=u({allowEmittingWithoutObserver:!0}),g=u({allowEmittingWithoutObserver:!0}),W=u({allowEmittingWithoutObserver:!0}),A=u({allowEmittingWithoutObserver:!0}),x=u({allowEmittingWithoutObserver:!0}),F=u({allowEmittingWithoutObserver:!0}),N=u({allowEmittingWithoutObserver:!0}),J=u({allowEmittingWithoutObserver:!0}),V=u({allowEmittingWithoutObserver:!0}),q=u({allowEmittingWithoutObserver:!0}),H=u({allowEmittingWithoutObserver:!0});e.addEventListener(t=>{var r,f,m,y,M,D,$;switch(t.event){case"ui:button:click":(r=a.get(t.payload.buttonId))==null||r.onClick.emit(t.payload.input);break;case"ui:form:input":(f=o.get(t.payload.modalId))==null||f.onInput.emit(t.payload.input);break;case"ui:prompt:input":(m=i.get(t.payload.modalId))==null||m.onInput.emit(t.payload.input);break;case"ui:widget:onLoad":(y=l.get(t.payload.widgetId))==null||y.onLoad.emit();break;case"ui:widget:onToggle":(M=l.get(t.payload.widgetId))==null||M.onToggle.emit(t.payload);break;case"participant:disconnected":(D=s.get(t.payload.participantUuid))==null||D.onDisconnect.emit(),s.delete(t.payload.participantUuid);break;case"event:conferenceStatus":b.emit(t.payload);break;case"event:connected":R.emit(t.payload);break;case"event:disconnected":p.emit(t.payload);break;case"event:userInitiatedDisconnect":P.emit(t.payload);break;case"event:me":O.emit(t.payload);break;case"event:message":n.emit(t.payload);break;case"event:directMessage":d.emit(t.payload);break;case"event:applicationMessage":g.emit(t.payload);break;case"event:transfer":W.emit(t.payload);break;case"event:cancelTransfer":A.emit(t.payload);break;case"event:stage":x.emit(t.payload);break;case"event:participants":k.emit(t.payload);break;case"event:participantLeft":v.emit(t.payload),($=s.get(t.payload.participant.uuid))==null||$.onDisconnect.emit(),s.delete(t.payload.participant.uuid);break;case"event:participantJoined":h.emit(t.payload);break;case"event:participantsActivities":I.emit(t.payload);break;case"event:raiseHand":B.emit(t.payload);break;case"event:presentationConnectionStateChange":F.emit(t.payload);break;case"event:layoutUpdate":N.emit(t.payload);break;case"event:conference:authenticated":c.emit(t.payload);break;case"event:breakoutBegin":J.emit(t.payload);break;case"event:breakoutEnd":V.emit(t.payload);break;case"event:breakoutRefer":q.emit(t.payload);break;case"event:languageSelect":H.emit(t.payload);break}});const S=async(t,r)=>{const f=await e.callRPC("ui:removeElement",{id:t});if(f.status==="failed")return Promise.reject({reason:f.reason});r&&r()};return{app:{setDisconnectDestination:async t=>await e.callRPC("app:setDisconnectDestination",t)},ui:{addButton:async t=>{const r=await e.callRPC("ui:button:add",t);if(r.status==="failed")return Promise.reject({reason:r.reason});const f={onClick:u({allowEmittingWithoutObserver:!0}),update:async m=>{const y=await e.callRPC("ui:button:update",{...m,targetId:r.id});return y.status==="failed"?Promise.reject({reason:y.reason}):y.data},remove:()=>S(r.id,()=>a.delete(r.id))};return a.set(r.id,f),f},addForm:async t=>{const r=await e.callRPC("ui:form:open",t);if(r.status==="failed")return Promise.reject({reason:r.reason});const f={onInput:u(),remove:()=>S(r.id,()=>o.delete(r.id))};return o.set(r.id,f),f},showForm:async t=>{const r=await e.callRPC("ui:form:open",t);return r.status==="failed"?Promise.reject({reason:r.reason}):new Promise(f=>{const m=y=>{y.event==="ui:form:input"&&y.payload.modalId===r.id&&(f(y.payload.input),S(r.id),e.removeEventListener(m))};e.addEventListener(m)})},addPrompt:async t=>{const r=await e.callRPC("ui:prompt:open",t);if(r.status==="failed")return Promise.reject({reason:r.reason});const f={onInput:u(),remove:()=>S(r.id,()=>i.delete(r.id))};return i.set(r.id,f),f},showPrompt:async t=>{const r=await e.callRPC("ui:prompt:open",t);return r.status==="failed"?Promise.reject({reason:r.reason}):new Promise(f=>{const m=y=>{y.event==="ui:prompt:input"&&y.payload.modalId===r.id&&(f(y.payload.input),S(r.id),e.removeEventListener(m))};e.addEventListener(m)})},showToast:async t=>{const r=await e.callRPC("ui:toast:show",t);if(r.status==="failed")return Promise.reject({reason:r.reason})},addWidget:async t=>{const r=await e.callRPC("ui:widget:add",t);if(r.status==="failed")return Promise.reject({reason:r.reason});const f={id:r.id,onLoad:u({allowEmittingWithoutObserver:!0}),onToggle:u({allowEmittingWithoutObserver:!0}),toggle:async()=>{const m=await e.callRPC("ui:widget:toggle",{id:r.id});return m.status==="failed"?Promise.reject({reason:m.reason}):m.data},remove:()=>S(r.id,()=>i.delete(r.id))};return l.set(r.id,f),f}},conference:{dialOut:async t=>{let r;const f=new Map;let m=()=>{};const y=new Promise(te=>{m=h.add(({participant:T})=>{r?r.data.result.includes(T.uuid)&&te(T):f.set(T.uuid,T)})});r=await e.callRPC("conference:dialOut",t);const M=r==null?void 0:r.data.result[0];if(!ce(M))throw Error("Could not dial out to specified uri");const D=f.get(M)??await y;m();const $={...D,onDisconnect:u({allowEmittingWithoutObserver:!0}),disconnect:async()=>(s.delete(M),e.callRPC("participant:disconnect",{participantUuid:M}))};return s.set(M,$),$},sendMessage:async t=>await e.callRPC("conference:sendMessage",t),sendApplicationMessage:async t=>await e.callRPC("conference:sendApplicationMessage",t),lock:async t=>await e.callRPC("conference:lock",t),muteAllGuests:async t=>await e.callRPC("conference:muteAllGuests",t),setBandwidth:async t=>await e.callRPC("conference:setBandwidth",t),setLayout:async t=>await e.callRPC("conference:setLayout",t),disconnectAll:async t=>await e.callRPC("conference:disconnectAll",t),requestParticipants:async t=>await e.callRPC("conference:requestParticipants",t),sendRequest:async t=>await e.callRPC("conference:sendRequest",t),transfer:async t=>await e.callRPC("participant:transfer",t),mute:async t=>await e.callRPC("participant:mute",t),muteVideo:async t=>await e.callRPC("participant:muteVideo",t),spotlight:async t=>await e.callRPC("participant:spotlight",t),admit:async t=>await e.callRPC("participant:admit",t),raiseHand:async t=>await e.callRPC("participant:raiseHand",t),setRole:async t=>await e.callRPC("participant:setRole",t),setTextOverlay:async t=>await e.callRPC("participant:setTextOverlay",t),sendDTMF:async t=>await e.callRPC("participant:sendDTMF",t),disconnect:async t=>{const r=t.participantUuid;return s.delete(r),await e.callRPC("participant:disconnect",{participantUuid:r})},breakout:async t=>await e.callRPC("conference:breakout",t),joinBreakoutRoom:async t=>await e.callRPC("conference:joinBreakoutRoom",t),closeBreakouts:async()=>await e.callRPC("conference:closeBreakouts",{}),closeBreakoutRoom:async t=>await e.callRPC("conference:closeBreakoutRoom",t),emptyBreakouts:async()=>await e.callRPC("conference:emptyBreakouts",{}),breakoutMoveParticipants:async t=>await e.callRPC("conference:breakoutMoveParticipants",t),getCurrentRoomId:async()=>await e.callRPC("conference:currentRoomId",void 0)},events:{authenticatedWithConference:c,conferenceStatus:b,connected:R,disconnected:p,userInitiatedDisconnect:P,me:O,message:n,directMessage:d,applicationMessage:g,transfer:W,cancelTransfer:A,stage:x,participants:k,participantJoined:h,participantLeft:v,participantsActivities:I,raiseHand:B,presentationConnectionStateChange:F,layoutUpdate:N,breakoutBegin:J,breakoutEnd:V,breakoutRefer:q,languageSelect:H}}};async function we(e){window.plugin={popupManager:Y()};const a=new L(window.parent,j(e.id)),s=await a.callRPC("syn",e);if(!s.ack)throw new Error(`Can't register plugin. ${JSON.stringify(s)}`);return ee(a)}async function ye(e){window.plugin={popupManager:Y()};const a=new L(window.parent,j(`${e.parentPluginId}:widget`)),s=await a.callRPC("syn:widget",e);if(!s.ack)throw new Error(`Can't register widget. ${JSON.stringify(s)}`);return ee(a)}export{ye as a,we as r};
