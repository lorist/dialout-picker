(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(r){if(r.ep)return;r.ep=!0;const l=s(r);fetch(r.href,l)}})();var q;(function(e){e[e.trace=10]="trace",e[e.debug=20]="debug",e[e.info=30]="info",e[e.warn=40]="warn",e[e.error=50]="error",e[e.fatal=60]="fatal",e[e.silent=9007199254740991]="silent"})(q||(q={}));function ee(){return Object.freeze({fatal:(e,a)=>console.error(a,e),error:(e,a)=>console.error(a,e),warn:(e,a)=>console.warn(a,e),info:(e,a)=>console.info(a,e),debug:(e,a)=>console.debug(a,e),trace(){},silent(){},redact(e){return e},addRedactPattern(){}})}let O=ee();const te={},N=e=>{const a=new Array;return{[Symbol.iterator]:()=>a[Symbol.iterator](),get size(){return a.length},add:s=>{e!==0&&(a.length<e?a.splice(e,0,s):(a.shift(),a.push(s)))},clear:()=>{a.length=0},entries:()=>a.entries()}},ae="Anonymous",re="AnonymousSignal",ne=2;function v(e){return e.name||ae}function p(e={variant:"generic"}){const{allowEmittingWithoutObserver:a=!1,variant:s="generic",name:n=re}=e??{},r=new Set,l=new WeakMap,i=new WeakSet;let w=!1,C=!1,d;switch(e==null?void 0:e.variant){case"batched":case"replay":{if(e.bufferSize!==void 0&&e.bufferSize<1)throw new Error("Batched/Replay Signal bufferSize must be greater than 0");if(e.bufferSize===1){const c={bufferSize:e.bufferSize,name:n,variant:s};switch(e.variant){case"batched":e.emitImmediatelyWhenFull&&O.warn(c,"Batched signal with buffer size of 1 is basically a Generic signal");break;case"replay":O.warn(c,"Replay signal with bufferSize of 1 is identical to Behavior signal");break}}d=N(e.bufferSize??ne);break}case"behavior":{d=N(1);break}}if((e==null?void 0:e.variant)==="batched"&&e.schedule===void 0)throw new Error("Batched signal requires a scheduler to be provided in the options");function P(c,f){try{const g=l.get(c);O.trace({signal:n,variant:s,subject:f,observer:c,context:g},`Emitting a subject to observer ${v(c)}`),c.call(g,f),i.has(c)&&y(c)}catch(g){throw O.error({signal:n,variant:s,error:g,observer:c,subject:f},`emit with error for observer ${v(c)}`),g instanceof RangeError?new RangeError(`RangeError: Possible recursive call when calling ${v(c)} for ${n}`):g}}const R=(c,f)=>{if(r.has(c)){const g=`Observer ${v(c)} has already been added!`;throw O.error({signal:n,variant:s,observer:c},g),new Error(`DuplicatedObserver: ${g}`)}switch(O.trace({signal:n,variant:s,observer:c},`Adding ${v(c)} to ${n}`),r.add(c),f!=null&&f.context&&l.set(c,f.context),s){case"replay":case"behavior":{for(const g of d??[])P(c,g);break}}if(f!=null&&f.signal){const g=()=>{var W;y(c),(W=f.signal)==null||W.removeEventListener("abort",g)};return f.signal.addEventListener("abort",g),g}return()=>y(c)},u=(c,f)=>{if(i.has(c)){const g=`${v(c)} has already been added once to ${n}!`;throw O.error({signal:n,variant:s,observer:c},g),new Error(`NoOnceAgain: ${g}`)}return i.add(c),R(c,f)},y=c=>{if(!r.delete(c))throw O.error({signal:n,variant:s,observer:c},`Unable to remove observer ${v(c)}`),new Error(`UnableToRemove: ${v(c)}`);i.delete(c),l.delete(c),O.trace({signal:n,variant:s,observer:c},`Removed ${v(c)} from ${n}`)},k=()=>r.size,S=()=>{if(!C||!d||d.size<1)return;const c=[];for(const f of d)f!==void 0&&c.push(f);d.clear();for(const f of r)P(f,c);w=!1,C=!1};function M(c){if(d)d.add(c);else if(!r.size&&!a){const{stack:f}=te.debug?new Error:{stack:void 0};O.warn({signal:n,variant:s,subject:c,stack:f},`Emitting ${n} without any observer! This may be a mistake.`)}switch(e.variant){case"batched":{e.emitImmediatelyWhenFull&&(d==null?void 0:d.size)===e.bufferSize?(C=!0,S()):!w&&(d==null?void 0:d.size)===1&&(w=!0,C=!0,e.schedule(S));break}default:{for(const f of r)P(f,c);break}}}return{name:n,get size(){return k()},add:R,addOnce:u,remove:y,emit:M}}var J;(function(e){e[e.trace=10]="trace",e[e.debug=20]="debug",e[e.info=30]="info",e[e.warn=40]="warn",e[e.error=50]="error",e[e.fatal=60]="fatal",e[e.silent=9007199254740991]="silent"})(J||(J={}));function ie(){return Object.freeze({fatal:(e,a)=>console.error(a,e),error:(e,a)=>console.error(a,e),warn:(e,a)=>console.warn(a,e),info:(e,a)=>console.info(a,e),debug:(e,a)=>console.debug(a,e),trace(){},silent(){},redact(e){return e},addRedactPattern(){}})}let U=ie();function oe(e){return typeof e=="string"&&e.length>0}function se(e){return!!(e&&typeof e=="object"&&"chanId"in e&&"event"in e)}function ce(e){return!!(e&&typeof e=="object"&&"chanId"in e&&"replyTo"in e)}const b=[];for(let e=0;e<256;++e)b.push((e+256).toString(16).slice(1));function le(e,a=0){return(b[e[a+0]]+b[e[a+1]]+b[e[a+2]]+b[e[a+3]]+"-"+b[e[a+4]]+b[e[a+5]]+"-"+b[e[a+6]]+b[e[a+7]]+"-"+b[e[a+8]]+b[e[a+9]]+"-"+b[e[a+10]]+b[e[a+11]]+b[e[a+12]]+b[e[a+13]]+b[e[a+14]]+b[e[a+15]]).toLowerCase()}let A;const ue=new Uint8Array(16);function de(){if(!A){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");A=crypto.getRandomValues.bind(crypto)}return A(ue)}const pe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),K={randomUUID:pe};function fe(e,a,s){var r;if(K.randomUUID&&!e)return K.randomUUID();e=e||{};const n=e.random??((r=e.rng)==null?void 0:r.call(e))??de();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,le(n)}function Y(e){return`${e?`${e}-`:""}${fe()}`}function me(){const e=new Map,a=new Set;return window.onbeforeunload=()=>{for(const i of a)clearInterval(i);a.clear()},{add:(i,w)=>{if(e.has(i)){U.warn(`A popup with with ID:'${i}' has already been registered`);return}e.set(i,{popup:null,shouldOpen:w})},remove:i=>{e.delete(i)},open:(i,w,C)=>{var R,u,y;e.has(i)||e.set(i,{popup:null});const d=e.get(i);if(d!=null&&d.popup&&!d.popup.closed){U.warn(`Popup with ID:'${i}' is currently opened`);return}if((R=e.get(i))!=null&&R.shouldOpen&&!((y=(u=e.get(i))==null?void 0:u.shouldOpen)!=null&&y.call(u,C??{})))return;const P=window.open(...w);if(d&&(d.popup=P),P){const k=window.setInterval(()=>{if(P.closed){const S=e.get(i);S&&(S.popup=null),clearInterval(k),a.delete(k)}},500);a.add(k)}},get:i=>{var w;return(w=e.get(i))==null?void 0:w.popup}}}class ge{constructor(a,s){this.target=a,this.chanId=s,this.pendingCalls=new Map,this.eventListeners=new Set,this.onMessage=n=>{if(n.data.chanId!==this.chanId)return;const r=n.data;if(U.debug({evt:n},`Message received for channel ${this.chanId}`),ce(r)){const[l,i]=this.pendingCalls.get(r.replyTo)??[];if(!l){U.debug({evt:n},"Resolve fn doesnt exist");return}this.pendingCalls.delete(r.replyTo),l(r.payload)}if(se(r))for(const l of this.eventListeners)l(r)},globalThis.addEventListener("message",this.onMessage)}addEventListener(a){this.eventListeners.add(a)}removeEventListener(a){this.eventListeners.delete(a)}emitEvent(a){this.target.postMessage({chanId:this.chanId,...a},"*")}callRPC(a,s,n){const r=Y();return U.debug({payload:s,id:r},`'${a}' called for channel ${this.chanId}`),new Promise((l,i)=>{this.pendingCalls.set(r,[l,i]),this.target.postMessage({rpc:a,payload:s,id:r,chanId:this.chanId},"*",n)})}replyRPC(a){this.emitEvent(a)}sendEvent(a){this.emitEvent(a)}unregister(){globalThis.removeEventListener("message",this.onMessage)}get targetWindow(){return this.target}}var Q;(function(e){e.audio="audio",e.video="video",e.api="api"})(Q||(Q={}));var Z;(function(e){e[e.Join=0]="Join",e[e.Leave=1]="Leave",e[e.Update=2]="Update"})(Z||(Z={}));const we=e=>{const a=new Map,s=new Map,n=new Map,r=new Map,l=new Map,i=p({allowEmittingWithoutObserver:!0}),w=p({allowEmittingWithoutObserver:!0}),C=p({allowEmittingWithoutObserver:!0}),d=p({allowEmittingWithoutObserver:!0}),P=p({allowEmittingWithoutObserver:!0}),R=p({allowEmittingWithoutObserver:!0}),u=p({allowEmittingWithoutObserver:!0}),y=p({allowEmittingWithoutObserver:!0}),k=p({allowEmittingWithoutObserver:!0}),S=p({allowEmittingWithoutObserver:!0}),M=p({allowEmittingWithoutObserver:!0}),c=p({allowEmittingWithoutObserver:!0}),f=p({allowEmittingWithoutObserver:!0}),g=p({allowEmittingWithoutObserver:!0}),W=p({allowEmittingWithoutObserver:!0}),z=p({allowEmittingWithoutObserver:!0}),j=p({allowEmittingWithoutObserver:!0}),x=p({allowEmittingWithoutObserver:!0}),F=p({allowEmittingWithoutObserver:!0}),H=p({allowEmittingWithoutObserver:!0}),_=p({allowEmittingWithoutObserver:!0}),G=p({allowEmittingWithoutObserver:!0}),V=p({allowEmittingWithoutObserver:!0});e.addEventListener(t=>{var o,m,h,E,I,$,D;switch(t.event){case"ui:button:click":(o=a.get(t.payload.buttonId))==null||o.onClick.emit(t.payload.input);break;case"ui:form:input":(m=n.get(t.payload.modalId))==null||m.onInput.emit(t.payload.input);break;case"ui:prompt:input":(h=r.get(t.payload.modalId))==null||h.onInput.emit(t.payload.input);break;case"ui:widget:onLoad":(E=l.get(t.payload.widgetId))==null||E.onLoad.emit();break;case"ui:widget:onToggle":(I=l.get(t.payload.widgetId))==null||I.onToggle.emit(t.payload);break;case"participant:disconnected":($=s.get(t.payload.participantUuid))==null||$.onDisconnect.emit(),s.delete(t.payload.participantUuid);break;case"event:conferenceStatus":w.emit(t.payload);break;case"event:connected":C.emit(t.payload);break;case"event:disconnected":d.emit(t.payload);break;case"event:userInitiatedDisconnect":P.emit(t.payload);break;case"event:me":R.emit(t.payload);break;case"event:message":c.emit(t.payload);break;case"event:directMessage":f.emit(t.payload);break;case"event:applicationMessage":g.emit(t.payload);break;case"event:transfer":W.emit(t.payload);break;case"event:cancelTransfer":z.emit(t.payload);break;case"event:stage":j.emit(t.payload);break;case"event:participants":u.emit(t.payload);break;case"event:participantLeft":k.emit(t.payload),(D=s.get(t.payload.participant.uuid))==null||D.onDisconnect.emit(),s.delete(t.payload.participant.uuid);break;case"event:participantJoined":y.emit(t.payload);break;case"event:participantsActivities":S.emit(t.payload);break;case"event:raiseHand":M.emit(t.payload);break;case"event:presentationConnectionStateChange":x.emit(t.payload);break;case"event:layoutUpdate":F.emit(t.payload);break;case"event:conference:authenticated":i.emit(t.payload);break;case"event:breakoutBegin":H.emit(t.payload);break;case"event:breakoutEnd":_.emit(t.payload);break;case"event:breakoutRefer":G.emit(t.payload);break;case"event:languageSelect":V.emit(t.payload);break}});const T=async(t,o)=>{const m=await e.callRPC("ui:removeElement",{id:t});if(m.status==="failed")return Promise.reject({reason:m.reason});o&&o()};return{app:{setDisconnectDestination:async t=>await e.callRPC("app:setDisconnectDestination",t)},ui:{addButton:async t=>{const o=await e.callRPC("ui:button:add",t);if(o.status==="failed")return Promise.reject({reason:o.reason});const m={onClick:p({allowEmittingWithoutObserver:!0}),update:async h=>{const E=await e.callRPC("ui:button:update",{...h,targetId:o.id});return E.status==="failed"?Promise.reject({reason:E.reason}):E.data},remove:()=>T(o.id,()=>a.delete(o.id))};return a.set(o.id,m),m},addForm:async t=>{const o=await e.callRPC("ui:form:open",t);if(o.status==="failed")return Promise.reject({reason:o.reason});const m={onInput:p(),remove:()=>T(o.id,()=>n.delete(o.id))};return n.set(o.id,m),m},showForm:async t=>{const o=await e.callRPC("ui:form:open",t);return o.status==="failed"?Promise.reject({reason:o.reason}):new Promise(m=>{const h=E=>{E.event==="ui:form:input"&&E.payload.modalId===o.id&&(m(E.payload.input),T(o.id),e.removeEventListener(h))};e.addEventListener(h)})},addPrompt:async t=>{const o=await e.callRPC("ui:prompt:open",t);if(o.status==="failed")return Promise.reject({reason:o.reason});const m={onInput:p(),remove:()=>T(o.id,()=>r.delete(o.id))};return r.set(o.id,m),m},showPrompt:async t=>{const o=await e.callRPC("ui:prompt:open",t);return o.status==="failed"?Promise.reject({reason:o.reason}):new Promise(m=>{const h=E=>{E.event==="ui:prompt:input"&&E.payload.modalId===o.id&&(m(E.payload.input),T(o.id),e.removeEventListener(h))};e.addEventListener(h)})},showToast:async t=>{const o=await e.callRPC("ui:toast:show",t);if(o.status==="failed")return Promise.reject({reason:o.reason})},addWidget:async t=>{const o=await e.callRPC("ui:widget:add",t);if(o.status==="failed")return Promise.reject({reason:o.reason});const m={id:o.id,onLoad:p({allowEmittingWithoutObserver:!0}),onToggle:p({allowEmittingWithoutObserver:!0}),toggle:async()=>{const h=await e.callRPC("ui:widget:toggle",{id:o.id});return h.status==="failed"?Promise.reject({reason:h.reason}):h.data},remove:()=>T(o.id,()=>r.delete(o.id))};return l.set(o.id,m),m}},conference:{dialOut:async t=>{let o;const m=new Map;let h=()=>{};const E=new Promise(L=>{h=y.add(({participant:B})=>{o?o.data.result.includes(B.uuid)&&L(B):m.set(B.uuid,B)})});o=await e.callRPC("conference:dialOut",t);const I=o==null?void 0:o.data.result[0];if(!oe(I))throw Error("Could not dial out to specified uri");const $=m.get(I)??await E;h();const D={...$,onDisconnect:p({allowEmittingWithoutObserver:!0}),disconnect:async()=>(s.delete(I),e.callRPC("participant:disconnect",{participantUuid:I}))};return s.set(I,D),D},sendMessage:async t=>await e.callRPC("conference:sendMessage",t),sendApplicationMessage:async t=>await e.callRPC("conference:sendApplicationMessage",t),lock:async t=>await e.callRPC("conference:lock",t),muteAllGuests:async t=>await e.callRPC("conference:muteAllGuests",t),setBandwidth:async t=>await e.callRPC("conference:setBandwidth",t),setLayout:async t=>await e.callRPC("conference:setLayout",t),disconnectAll:async t=>await e.callRPC("conference:disconnectAll",t),requestParticipants:async t=>await e.callRPC("conference:requestParticipants",t),sendRequest:async t=>await e.callRPC("conference:sendRequest",t),transfer:async t=>await e.callRPC("participant:transfer",t),mute:async t=>await e.callRPC("participant:mute",t),muteVideo:async t=>await e.callRPC("participant:muteVideo",t),spotlight:async t=>await e.callRPC("participant:spotlight",t),admit:async t=>await e.callRPC("participant:admit",t),raiseHand:async t=>await e.callRPC("participant:raiseHand",t),setRole:async t=>await e.callRPC("participant:setRole",t),setTextOverlay:async t=>await e.callRPC("participant:setTextOverlay",t),sendDTMF:async t=>await e.callRPC("participant:sendDTMF",t),disconnect:async t=>{const o=t.participantUuid;return s.delete(o),await e.callRPC("participant:disconnect",{participantUuid:o})},breakout:async t=>await e.callRPC("conference:breakout",t),joinBreakoutRoom:async t=>await e.callRPC("conference:joinBreakoutRoom",t),closeBreakouts:async()=>await e.callRPC("conference:closeBreakouts",{}),closeBreakoutRoom:async t=>await e.callRPC("conference:closeBreakoutRoom",t),emptyBreakouts:async()=>await e.callRPC("conference:emptyBreakouts",{}),breakoutMoveParticipants:async t=>await e.callRPC("conference:breakoutMoveParticipants",t),getCurrentRoomId:async()=>await e.callRPC("conference:currentRoomId",void 0)},events:{authenticatedWithConference:i,conferenceStatus:w,connected:C,disconnected:d,userInitiatedDisconnect:P,me:R,message:c,directMessage:f,applicationMessage:g,transfer:W,cancelTransfer:z,stage:j,participants:u,participantJoined:y,participantLeft:k,participantsActivities:S,raiseHand:M,presentationConnectionStateChange:x,layoutUpdate:F,breakoutBegin:H,breakoutEnd:_,breakoutRefer:G,languageSelect:V}}};async function ye(e){window.plugin={popupManager:me()};const a=new ge(window.parent,Y(e.id)),s=await a.callRPC("syn",e);if(!s.ack)throw new Error(`Can't register plugin. ${JSON.stringify(s)}`);return we(a)}const X="./data/dial_targets.csv",he=[{label:"Boardroom (SIP)",destination:"sip:boardroom@example.com",protocol:"auto",role:"GUEST"},{label:"Security desk (SIP)",destination:"sip:security@company.com",protocol:"auto",role:"GUEST"},{label:"Legacy codec",destination:"h323:10.0.0.50",protocol:"auto",role:"GUEST"},{label:"Recorder",destination:"rtmp://recorder.example.com/live/room1",protocol:"auto",role:"GUEST"}];function be(e){const a=(e||"").trim().toLowerCase();return!a||a==="auto"?"auto":a==="sip"||a==="h323"||a==="mssip"||a==="rtmp"?a:"auto"}function Pe(e){return(e||"").trim().toLowerCase()==="host"?"HOST":"GUEST"}function Ee(e){return e.replace(/^\uFEFF/,"")}function Re(e){const a=(e||"").trim().toLowerCase();return/^[a-z][a-z0-9+.-]*:/.test(a)}function Ce(e){const a=[];let s=[],n="",r=!1;for(let l=0;l<e.length;l++){const i=e[l];if(r){i==='"'?e[l+1]==='"'?(n+='"',l++):r=!1:n+=i;continue}if(i==='"'){r=!0;continue}if(i===","){s.push(n),n="";continue}if(i===`
`){s.push(n),a.push(s),s=[],n="";continue}i!=="\r"&&(n+=i)}return(n.length||s.length)&&(s.push(n),a.push(s)),a}function ke(e){const a=Ce(Ee(e)).filter(u=>u.some(y=>(y||"").trim()!==""));if(!a.length)return[];const s=a[0].map(u=>(u||"").trim().toLowerCase()),n=u=>s.indexOf(u),r=n("label"),l=n("destination"),i=n("protocol"),w=n("role"),P=(s.includes("label")||s.includes("destination")||s.includes("protocol")||s.includes("role")?a.slice(1):a).map(u=>u.map(y=>(y??"").trim())).map(u=>{const y=(r>=0?u[r]:u[0])||"",k=(l>=0?u[l]:u[1])||"",S=be(i>=0?u[i]:u[2]),M=Pe(w>=0?u[w]:u[3]);return{label:y,destination:k,protocol:S,role:M}}).filter(u=>u.label&&u.destination),R=new Set;return P.filter(u=>R.has(u.destination)?!1:(R.add(u.destination),!0))}async function Se(){try{const e=await fetch(X,{cache:"no-store"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const a=await e.text(),s=ke(a);if(!s.length)throw new Error("CSV parsed but no entries found");return s}catch(e){return console.warn(`dialout-picker: CSV load failed (${X}). Using fallback list.`,e),he}}(async()=>{const e=await ye({id:"dialout-picker",version:1});(await e.ui.addButton({position:"toolbar",icon:"IconPhone",tooltip:"Dial out",roles:["chair"]})).onClick.add(async()=>{const s=await Se(),n=new Map(s.map(r=>[r.destination,r]));try{const r=await e.ui.showForm({title:"Dial out from this meeting",description:"Select a target to dial into this VMR.",form:{submitBtnTitle:"Dial",elements:{target:{name:"Target",type:"select",required:!0,options:s.map(u=>({id:u.destination,label:u.label}))},join_as:{name:"Join as",type:"select",required:!0,selected:"guest",options:[{id:"guest",label:"Guest"},{id:"host",label:"Host"}]},protocol:{name:"Protocol (only used if destination has no scheme)",type:"select",required:!0,selected:"auto",options:[{id:"auto",label:"Auto"},{id:"sip",label:"SIP"},{id:"h323",label:"H.323"},{id:"mssip",label:"MS SIP"},{id:"rtmp",label:"RTMP"}]},display_name:{name:"Display name (recommended)",type:"text",placeholder:"Defaults to the selected label",required:!1}}}}),l=r.target,i=n.get(l),w=(i==null?void 0:i.role)||(r.join_as==="host"?"HOST":"GUEST"),C=Re(l),d=i!=null&&i.protocol&&i.protocol!=="auto"?i.protocol:r.protocol||"auto",P=(r.display_name||"").trim()||(i==null?void 0:i.label)||"Dial-out participant",R={destination:l,role:w,protocol:"auto",remote_display_name:P,text:P};!C&&d&&d!=="auto"&&(R.protocol=d),console.log("DIALOUT-PICKER dialArgs:",R),await e.conference.dialOut(R),await e.ui.showToast({message:`Dialing ${P}â€¦`,type:"success"})}catch(r){await e.ui.showToast({message:`Dial-out failed: ${(r==null?void 0:r.message)||r}`,type:"danger"})}})})();
